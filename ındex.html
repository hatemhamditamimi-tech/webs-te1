<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø­Ø§Ø³Ø¨Ø© Ø²Ù…Ù† ØªØ¬Ù…ÙŠØ¯ Ø§Ù„Ø£ØºØ°ÙŠØ©</title>
  <style>
    :root{
      --bg:#0f172a; /* slate-900 */
      --card:#111827; /* gray-900 */
      --muted:#94a3b8; /* slate-400 */
      --text:#e5e7eb; /* gray-200 */
      --brand:#22d3ee; /* cyan-400 */
      --accent:#a78bfa; /* violet-400 */
      --ok:#34d399; /* green-400 */
      --warn:#fbbf24; /* amber-400 */
      --bad:#f87171; /* red-400 */
      --stroke:#1f2937; /* gray-800 */
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#0b1022,#0f172a 35%,#0b1022);color:var(--text);font-family:"Tajawal",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";}
    .container{max-width:1200px;margin:auto;padding:24px}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:16px}
    .title{font-size:clamp(20px,2.6vw,32px);font-weight:800;letter-spacing:.2px}
    .sub{color:var(--muted);font-size:14px}
    .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:16px}
    @media (max-width: 980px){.grid{grid-template-columns:1fr;}}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));border:1px solid var(--stroke);border-radius:20px;box-shadow:0 6px 30px rgba(0,0,0,.25);padding:18px}
    .card h2{margin:0 0 12px;font-size:18px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .row-3{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .field{display:flex;flex-direction:column;gap:6px}
    .field label{font-size:13px;color:var(--muted)}
    input, select{width:100%;padding:12px 12px;border-radius:12px;border:1px solid var(--stroke);background:#0b1328;color:var(--text);outline:none}
    input:focus, select:focus{border-color:var(--brand);box-shadow:0 0 0 3px rgba(34,211,238,.15)}
    .help{font-size:12px;color:var(--muted)}
    .btns{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
    button{border:1px solid var(--stroke);background:#0b1328;color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer}
    button.primary{background:linear-gradient(135deg,var(--brand),var(--accent));border:none;color:#001119;font-weight:700}
    button.ghost{background:transparent}
    .kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-top:12px}
    @media (max-width: 700px){.kpis{grid-template-columns:repeat(2,1fr)}}
    .kpi{background:#0b1328;border:1px dashed var(--stroke);border-radius:16px;padding:14px}
    .kpi .v{font-size:22px;font-weight:800}
    .kpi .l{font-size:12px;color:var(--muted)}
    .timeline{margin-top:16px;background:#0b1328;border:1px solid var(--stroke);border-radius:14px;padding:14px}
    .bar{position:relative;height:14px;background:#0a0f20;border-radius:999px;border:1px solid var(--stroke);overflow:hidden}
    .seg{position:absolute;top:0;bottom:0}
    .seg.cool{background:linear-gradient(90deg,#60a5fa,#22d3ee)}
    .seg.freeze{background:linear-gradient(90deg,#22d3ee,#a78bfa)}
    .seg.sub{background:linear-gradient(90deg,#a78bfa,#f472b6)}
    .legend{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;font-size:12px;color:var(--muted)}
    .legend span{display:inline-flex;align-items:center;gap:6px}
    .sw{width:14px;height:8px;border-radius:999px;display:inline-block}
    .tips{font-size:13px;color:var(--muted);line-height:1.7}
    .status{margin-top:10px;font-size:13px}
    .status.good{color:var(--ok)}
    .status.warn{color:var(--warn)}
    .status.bad{color:var(--bad)}
    footer{margin-top:22px;display:flex;gap:8px;align-items:center;justify-content:space-between;color:var(--muted);font-size:12px}
    .pill{display:inline-flex;align-items:center;gap:8px;background:#0b1328;border:1px solid var(--stroke);border-radius:999px;padding:8px 12px}
    .split{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width: 700px){.split{grid-template-columns:1fr}}
    .notice{border-left:4px solid var(--brand);padding:10px 12px;background:#0b1328;border-radius:12px}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <div class="title">Ø­Ø§Ø³Ø¨Ø© Ø²Ù…Ù† Ø§Ù„ØªØ¬Ù…ÙŠØ¯ Ù„Ù„Ø£ØºØ°ÙŠØ©</div>
        <div class="sub">ØªÙ‚Ø¯ÙŠØ± Ø²Ù…Ù†ÙŠ Ø°ÙƒÙŠ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø®ØµØ§Ø¦Øµ Ø§Ù„Ù…Ø§Ø¯Ø©ØŒ Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠØŒ ÙˆØ¸Ø±ÙˆÙ Ø§Ù„Ù…Ø¬Ù…Ø¯. Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ù„ØºØ±Ø¶ Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ/Ø§Ù„Ù…Ù†Ø²Ù„ÙŠ.</div>
      </div>
      <div class="pill">ğŸ” <span id="presetLabel">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¢Ù…Ù†Ø©</span></div>
    </header>

    <div class="grid">
      <!-- Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª -->
      <section class="card">
        <h2>Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª</h2>
        <div class="row">
          <div class="field">
            <label>Ù†ÙˆØ¹ Ø§Ù„ØºØ°Ø§Ø¡</label>
            <select id="food">
              <option value="beef">Ù„Ø­Ù… Ø¨Ù‚Ø±ÙŠ</option>
              <option value="chicken">Ø¯Ø¬Ø§Ø¬</option>
              <option value="fish">Ø³Ù…Ùƒ</option>
              <option value="bread">Ø®Ø¨Ø²</option>
              <option value="strawberry">ÙØ±Ø§ÙˆÙ„Ø©</option>
              <option value="peas">Ø¨Ø§Ø²Ù„Ø§Ø¡</option>
              <option value="icecream">Ø¢ÙŠØ³ ÙƒØ±ÙŠÙ…</option>
              <option value="custom">Ù…Ø®ØµØµâ€¦</option>
            </select>
            <div class="help">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø© Ù„ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹. ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ ÙÙŠ ØªØ¨ÙˆÙŠØ¨ "Ø®ØµØ§Ø¦Øµ Ø§Ù„Ù…Ø§Ø¯Ø©".</div>
          </div>
          <div class="field">
            <label>Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¬Ù…Ø¯ (Â°Ù…)</label>
            <input id="Tair" type="number" step="0.1" value="-20" />
            <div class="help">Ø¹Ø§Ø¯Ø© Ø¨ÙŠÙ† âˆ’18 Ùˆ âˆ’30Â°Ù….</div>
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label>Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Â°Ù…)</label>
            <input id="Tinit" type="number" step="0.1" value="5" />
          </div>
          <div class="field">
            <label>Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© ÙÙŠ Ù‚Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬ (Â°Ù…)</label>
            <input id="Ttarget" type="number" step="0.1" value="-18" />
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label>Ø§Ù„Ù‡Ù†Ø¯Ø³Ø©</label>
            <select id="shape">
              <option value="slab">Ø´Ø±ÙŠØ­Ø© (Ø·ÙˆÙ„ Ã— Ø¹Ø±Ø¶ Ã— Ø³Ù…Ø§ÙƒØ©)</option>
              <option value="cylinder">Ø£Ø³Ø·ÙˆØ§Ù†Ø© (Ù‚Ø·Ø± Ã— Ø§Ø±ØªÙØ§Ø¹)</option>
              <option value="sphere">ÙƒØ±Ø© (Ù‚Ø·Ø±)</option>
            </select>
          </div>
          <div class="field">
            <label>ÙˆØ¶Ø¹ÙŠØ© Ø§Ù„ØªØ¹Ø¨Ø¦Ø©/Ø§Ù„ØªØºÙ„ÙŠÙ</label>
            <select id="pack">
              <option value="bare">Ø¨Ø¯ÙˆÙ† ØªØºÙ„ÙŠÙ/Ù…Ù„Ø§Ù…Ø³ Ù„Ù„Ù‡ÙˆØ§Ø¡</option>
              <option value="wrap">ØªØºÙ„ÙŠÙ Ø±Ù‚ÙŠÙ‚ (Ù†Ø§ÙŠÙ„ÙˆÙ†/ÙƒÙŠØ³)</option>
              <option value="box">Ø¹Ù„Ø¨Ø©/ÙƒØ±ØªÙˆÙ†</option>
            </select>
          </div>
        </div>

        <div id="dims" class="row-3">
          <div class="field slab-only">
            <label>Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…)</label>
            <input id="L" type="number" step="0.1" value="20" />
          </div>
          <div class="field slab-only">
            <label>Ø§Ù„Ø¹Ø±Ø¶ (Ø³Ù…)</label>
            <input id="W" type="number" step="0.1" value="10" />
          </div>
          <div class="field slab-only">
            <label>Ø§Ù„Ø³Ù…Ø§ÙƒØ© (Ø³Ù…)</label>
            <input id="T" type="number" step="0.1" value="4" />
          </div>
          <div class="field cyl-only" style="display:none">
            <label>Ø§Ù„Ù‚Ø·Ø± (Ø³Ù…)</label>
            <input id="D" type="number" step="0.1" value="10" />
          </div>
          <div class="field cyl-only" style="display:none">
            <label>Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ (Ø³Ù…)</label>
            <input id="H" type="number" step="0.1" value="8" />
          </div>
          <div class="field sph-only" style="display:none">
            <label>Ù‚Ø·Ø± Ø§Ù„ÙƒØ±Ø© (Ø³Ù…)</label>
            <input id="Ds" type="number" step="0.1" value="8" />
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label>Ø³Ø±Ø¹Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡/ØªØ¯ÙÙ‚Ù‡</label>
            <select id="airflow">
              <option value="low">Ù…Ù†Ø®ÙØ¶ (Ù…Ø¬Ù…Ø¯ Ù…Ù†Ø²Ù„ÙŠ)</option>
              <option value="med" selected>Ù…ØªÙˆØ³Ø·</option>
              <option value="high">Ø¹Ø§Ù„Ù (Ù†ÙÙ‚ ØªØ¬Ù…ÙŠØ¯)</option>
            </select>
          </div>
          <div class="field">
            <label>Ù…Ø¹Ø§Ù…Ù„ Ø£Ù…Ø§Ù† (Ùª Ø²ÙŠØ§Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø²Ù…Ù†)</label>
            <input id="safety" type="number" step="1" value="10" />
          </div>
        </div>

        <div class="btns">
          <button class="primary" id="calc">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø²Ù…Ù†</button>
          <button id="reset">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø·</button>
          <button class="ghost" id="exportCsv">ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ CSV</button>
          <button class="ghost" id="share">Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        </div>

        <div class="notice" style="margin-top:12px">
          â—€ï¸ <strong>Ù…Ù„Ø§Ø­Ø¸Ø© Ù†Ù…Ø°Ø¬Ø©:</strong> ÙŠØ¹ØªÙ…Ø¯ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¹Ù„Ù‰ Ù†Ù…ÙˆØ°Ø¬ Ù…Ø¨Ø³Ù‘Ø· Ù…Ù† Ø«Ù„Ø§Ø« Ù…Ø±Ø§Ø­Ù„ (ØªØ¨Ø±ÙŠØ¯ Ø­ØªÙ‰ Ù†Ù‚Ø·Ø© Ø§Ù„ØªØ¬Ù…Ø¯ØŒ ØªØ¬Ù…ÙŠØ¯ Ø·ÙˆØ±ÙŠØŒ ØªØ¨Ø±ÙŠØ¯ ØªØ­Øª Ø§Ù„ØªØ¬Ù…Ù‘ÙØ¯) Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªÙ‚Ø±ÙŠØ¨ Ø§Ù„ÙƒØªÙ„Ø© Ø§Ù„Ù…ØªÙƒØªÙ„Ø© (lumped) ÙˆÙ…Ø¹Ø§Ù…Ù„ Ø§Ù†ØªÙ‚Ø§Ù„ Ø­Ø±Ø§Ø±ÙŠ ØªÙ‚Ø¯ÙŠØ±ÙŠ Ø­Ø³Ø¨ ØªØ¯ÙÙ‚ Ø§Ù„Ù‡ÙˆØ§Ø¡ ÙˆØ§Ù„ØªØ¹Ø¨Ø¦Ø©. Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¥Ø±Ø´Ø§Ø¯ÙŠØ© ÙˆÙ„ÙŠØ³Øª Ø¨Ø¯ÙŠÙ„Ø§Ù‹ Ø¹Ù† Ù‚ÙŠØ§Ø³ Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù†ÙˆØ§Ø© Ø¨Ø§Ù„Ù…Ø³Ø¨Ø§Ø±.
        </div>
      </section>

      <!-- Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª -->
      <section class="card">
        <h2>Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h2>
        <div class="kpis">
          <div class="kpi"><div class="v" id="t_total">â€”</div><div class="l">Ø§Ù„Ø²Ù…Ù† Ø§Ù„ÙƒÙ„ÙŠ</div></div>
          <div class="kpi"><div class="v" id="t1">â€”</div><div class="l">ØªØ¨Ø±ÙŠØ¯ Ø­ØªÙ‰ Ø§Ù„ØªØ¬Ù…Ø¯</div></div>
          <div class="kpi"><div class="v" id="t2">â€”</div><div class="l">Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ¬Ù…ÙŠØ¯</div></div>
          <div class="kpi"><div class="v" id="t3">â€”</div><div class="l">ØªØ¨Ø±ÙŠØ¯ ØªØ­Øª Ø§Ù„ØªØ¬Ù…Ø¯</div></div>
        </div>

        <div class="timeline">
          <div class="bar" id="bar">
            <div class="seg cool" id="seg1" style="left:0;width:0%"></div>
            <div class="seg freeze" id="seg2" style="left:0;width:0%"></div>
            <div class="seg sub" id="seg3" style="left:0;width:0%"></div>
          </div>
          <div class="legend">
            <span><i class="sw" style="background:#60a5fa"></i> ØªØ¨Ø±ÙŠØ¯ ÙÙˆÙ‚ Ù†Ù‚Ø·Ø© Ø§Ù„ØªØ¬Ù…Ø¯</span>
            <span><i class="sw" style="background:#22d3ee"></i> ØªØ¬Ù…ÙŠØ¯ (ØªØ­ÙˆÙ‘Ù„ Ø·ÙˆØ±ÙŠ)</span>
            <span><i class="sw" style="background:#a78bfa"></i> ØªØ¨Ø±ÙŠØ¯ ØªØ­Øª Ø§Ù„ØªØ¬Ù…Ø¯</span>
          </div>
          <div id="status" class="status">â€”</div>
        </div>

        <div class="card" style="margin-top:12px">
          <h2>Ø®ØµØ§Ø¦Øµ Ø§Ù„Ù…Ø§Ø¯Ø© (Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)</h2>
          <div class="split">
            <div>
              <div class="field"><label>Ø§Ù„ÙƒØ«Ø§ÙØ© Ï (ÙƒØº/Ù…Â³)</label><input id="rho" type="number" step="1" value="1060"></div>
              <div class="field"><label>Ù†Ù‚Ø·Ø© Ø§Ù„ØªØ¬Ù…Ø¯/Ø§Ù„Ø§Ù†ØµÙ‡Ø§Ø± T<sub>f</sub> (Â°Ù…)</label><input id="Tf" type="number" step="0.1" value="-1.5"></div>
              <div class="field"><label>Ø­Ø±Ø§Ø±Ø© ÙƒØ§Ù…Ù†Ø© L (ÙƒØ¬/ÙƒØº)</label><input id="Lh" type="number" step="1" value="250"></div>
            </div>
            <div>
              <div class="field"><label>Ø­Ø±Ø§Ø±Ø© Ù†ÙˆØ¹ÙŠØ© ÙÙˆÙ‚ Ø§Ù„ØªØ¬Ù…Ø¯ c<sub>u</sub> (ÙƒØ¬/ÙƒØºÂ·Ùƒ)</label><input id="cu" type="number" step="0.01" value="3.2"></div>
              <div class="field"><label>Ø­Ø±Ø§Ø±Ø© Ù†ÙˆØ¹ÙŠØ© ØªØ­Øª Ø§Ù„ØªØ¬Ù…Ø¯ c<sub>f</sub> (ÙƒØ¬/ÙƒØºÂ·Ùƒ)</label><input id="cf" type="number" step="0.01" value="1.7"></div>
              <div class="field"><label>Ù…ÙˆØµÙ„ÙŠØ© Ø­Ø±Ø§Ø±ÙŠØ© k (Ùˆ/Ù…Â·Ùƒ)</label><input id="k" type="number" step="0.01" value="1.5"></div>
            </div>
          </div>
          <div class="help">Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø±Ø·ÙˆØ¨Ø©. Ø¹Ø¯Ù‘Ù„ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ§Ù„Ø±Ø·ÙˆØ¨Ø© Ù„Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¯Ù‚Ø©.</div>
        </div>
      </section>
    </div>

    <footer>
      <div>ğŸ’¡ Ø¬Ø±Ù‘Ø¨ ØªØºÙŠÙŠØ± Ø§Ù„Ø³Ù…Ø§ÙƒØ©/Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ ÙˆÙ„Ø§Ø­Ø¸ Ø£Ù† Ø§Ù„Ø²Ù…Ù† ÙŠØªÙ†Ø§Ø³Ø¨ ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ Ù…Ø¹ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨ÙØ¹Ø¯ Ø§Ù„Ù…Ù…ÙŠÙ‘Ø².</div>
      <div>Â© Ø£Ø¯Ø§Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ©</div>
    </footer>
  </div>

  <script>
    // Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¨Ø³Ø·Ø© Ù„Ø®ØµØ§Ø¦Øµ Ø¨Ø¹Ø¶ Ø§Ù„Ø£ØºØ°ÙŠØ© (Ù‚ÙÙŠÙÙ… ØªÙ‚Ø±ÙŠØ¨ÙŠØ©)
    const FOODS = {
      beef:   { rho: 1050, Tf: -1.8, Lh: 230, cu: 3.1, cf: 1.6, k: 1.4 },
      chicken:{ rho: 1080, Tf: -2.2, Lh: 240, cu: 3.2, cf: 1.7, k: 1.4 },
      fish:   { rho: 1060, Tf: -1.0, Lh: 250, cu: 3.6, cf: 1.9, k: 1.3 },
      bread:  { rho: 450,  Tf: -5.0, Lh: 150, cu: 2.3, cf: 1.3, k: 0.3 },
      strawberry:{ rho: 980, Tf: -1.2, Lh: 260, cu: 3.8, cf: 1.9, k: 0.6 },
      peas:   { rho: 910,  Tf: -1.8, Lh: 250, cu: 3.6, cf: 1.8, k: 0.5 },
      icecream:{ rho: 560, Tf: -2.5, Lh: 210, cu: 2.2, cf: 1.9, k: 0.5 },
      custom: { rho: 1060, Tf: -1.5, Lh: 250, cu: 3.2, cf: 1.7, k: 1.5 }
    };

    const airflowH = { // Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù†ØªÙ‚Ø§Ù„ Ø­Ø±Ø§Ø±ÙŠ ØªÙ‚Ø±ÙŠØ¨ÙŠØ© (Ùˆ/Ù…Â²Â·Ùƒ)
      low: 6,
      med: 12,
      high: 25
    };

    const packFactor = { // ØªØ®ÙÙŠØ¶ h Ø¨Ø³Ø¨Ø¨ Ø§Ù„ØªØºÙ„ÙŠÙ
      bare: 1.0,
      wrap: 0.7,
      box: 0.45
    };

    // Ø¹Ù†Ø§ØµØ± DOM
    const el = id => document.getElementById(id);
    const foodSel = el('food');
    const Tair = el('Tair');
    const Tinit = el('Tinit');
    const Ttarget = el('Ttarget');
    const shapeSel = el('shape');
    const packSel = el('pack');
    const airflowSel = el('airflow');
    const safety = el('safety');

    const tTotal = el('t_total');
    const t1Out = el('t1');
    const t2Out = el('t2');
    const t3Out = el('t3');
    const seg1 = el('seg1');
    const seg2 = el('seg2');
    const seg3 = el('seg3');
    const status = el('status');

    // Ø®ØµØ§Ø¦Øµ Ø§Ù„Ù…Ø§Ø¯Ø© (Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)
    const rho = el('rho');
    const Tf = el('Tf');
    const Lh = el('Lh');
    const cu = el('cu');
    const cf = el('cf');
    const k = el('k');

    function loadFoodProps(){
      const f = FOODS[foodSel.value];
      if(!f) return;
      rho.value = f.rho; Tf.value = f.Tf; Lh.value = f.Lh; cu.value = f.cu; cf.value = f.cf; k.value = f.k;
    }

    // ØªØ­Ø¯ÙŠØ« Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ø¨Ø­Ø³Ø¨ Ø§Ù„Ø´ÙƒÙ„
    function updateDimsUI(){
      const shape = shapeSel.value;
      [...document.querySelectorAll('.slab-only')].forEach(n=>n.style.display = shape==='slab' ? '' : 'none');
      [...document.querySelectorAll('.cyl-only')].forEach(n=>n.style.display = shape==='cylinder' ? '' : 'none');
      [...document.querySelectorAll('.sph-only')].forEach(n=>n.style.display = shape==='sphere' ? '' : 'none');
    }

    // Ø£Ø¯ÙˆØ§Øª Ù‡Ù†Ø¯Ø³ÙŠØ©
    function geom(shape){
      // ØªÙØ±Ø¬Ø¹ Ø§Ù„Ø­Ø¬Ù… (Ù…Â³) ÙˆØ§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø³Ø·Ø­ÙŠØ© (Ù…Â²) ÙˆØ§Ù„Ø¨ÙØ¹Ø¯ Ø§Ù„Ù…Ù…ÙŠØ² (Ù…)
      if(shape==='slab'){
        const Lcm = parseFloat(el('L').value)||0, Wcm=parseFloat(el('W').value)||0, Tcm=parseFloat(el('T').value)||0;
        const Lm=Lcm/100, Wm=Wcm/100, Tm=Tcm/100;
        const V = Lm*Wm*Tm;
        const A = 2*(Lm*Wm + Lm*Tm + Wm*Tm);
        const Dchar = Tm; // Ù„Ù„Ø³Ù„Ø§ÙŠØ³Ø§Øª Ø§Ù„Ø³Ù…Ùƒ Ù‡Ùˆ Ø§Ù„Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø³ÙŠØ·Ø±
        return {V,A,Dchar};
      }
      if(shape==='cylinder'){
        const Dcm=parseFloat(el('D').value)||0, Hcm=parseFloat(el('H').value)||0;
        const Rm=(Dcm/100)/2, Hm=Hcm/100;
        const V = Math.PI*Rm*Rm*Hm;
        const A = 2*Math.PI*Rm*Rm + 2*Math.PI*Rm*Hm;
        const Dchar = Math.min(2*Rm,Hm); // ØªÙ‚Ø±ÙŠØ¨ÙŠ
        return {V,A,Dchar};
      }
      if(shape==='sphere'){
        const Dcm=parseFloat(el('Ds').value)||0; const Rm=(Dcm/100)/2;
        const V = 4/3*Math.PI*Math.pow(Rm,3);
        const A = 4*Math.PI*Math.pow(Rm,2);
        const Dchar = 2*Rm; // Ø§Ù„Ù‚Ø·Ø±
        return {V,A,Dchar};
      }
      return {V:0,A:0,Dchar:0};
    }

    function fmtMinutes(mins){
      if(!isFinite(mins) || mins<=0) return 'â€”';
      const h = Math.floor(mins/60);
      const m = Math.round(mins%60);
      if(h<=0) return `${m} Ø¯`;
      return `${h} Ø³ ${m} Ø¯`;
    }

    function clamp(val,min,max){return Math.max(min,Math.min(max,val));}

    function calc(){
      const props = {
        rho: parseFloat(rho.value),
        Tf: parseFloat(Tf.value),
        Lh: parseFloat(Lh.value)*1000, // Ø¥Ù„Ù‰ Ø¬ÙˆÙ„/ÙƒØº
        cu: parseFloat(cu.value)*1000, // Ø¥Ù„Ù‰ Ø¬ÙˆÙ„/ÙƒØºÂ·Ùƒ
        cf: parseFloat(cf.value)*1000,
        k:  parseFloat(k.value)
      };

      const Ta = parseFloat(Tair.value);
      const Ti = parseFloat(Tinit.value);
      const Tt = parseFloat(Ttarget.value);
      const {V,A,Dchar} = geom(shapeSel.value);

      if(V<=0 || A<=0){
        status.className='status bad';
        status.textContent='Ø£Ø¯Ø®Ù„ Ø£Ø¨Ø¹Ø§Ø¯Ø§Ù‹ ØµØ­ÙŠØ­Ø©.';
        [tTotal,t1Out,t2Out,t3Out].forEach(n=>n.textContent='â€”');
        [seg1,seg2,seg3].forEach(n=>n.style.width='0%');
        return;
      }

      // Ø§Ù„ÙƒØªÙ„Ø©
      const m = props.rho * V; // ÙƒØº

      // ØªÙ‚Ø¯ÙŠØ± h (Ùˆ/Ù…Â²Â·Ùƒ)
      const hBase = airflowH[airflowSel.value] || 10;
      const h = hBase * (packFactor[packSel.value]||1);

      // ØªØ­Ù‚Ù‚ Ù‚Ø§Ø¨Ù„ÙŠØ© Ø§Ù„ØªØ¬Ù…ÙŠØ¯
      if(Ta >= props.Tf){
        status.className='status bad';
        status.textContent='âš ï¸ Ù„Ù† ÙŠØ­Ø¯Ø« ØªØ¬Ù…ÙŠØ¯ Ù„Ø£Ù† Ù‡ÙˆØ§Ø¡ Ø§Ù„Ù…Ø¬Ù…Ø¯ Ø£Ø¹Ù„Ù‰ Ù…Ù†/Ù‚Ø±ÙŠØ¨ Ø¬Ø¯Ø§Ù‹ Ù…Ù† Ù†Ù‚Ø·Ø© ØªØ¬Ù…Ø¯ Ø§Ù„Ù…Ø§Ø¯Ø©.';
      }

      // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: ØªØ¨Ø±ÙŠØ¯ Ù…Ù† Ti Ø¥Ù„Ù‰ Tf (Ø¥Ù† ÙƒØ§Ù† Ti>Tf)
      let t1 = 0; // Ø«Ø§Ù†ÙŠØ©
      if(Ti > props.Tf){
        const num = m * props.cu;
        const arg = (Ti - Ta) / (props.Tf - Ta);
        if(arg>1){ // log Ù…ÙˆØ¬Ø¨
          t1 = (num/(h*A)) * Math.log(arg);
        }
      }

      // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: ØªØ¬Ù…ÙŠØ¯ Ø¹Ù†Ø¯ Tf (ØªØ­ÙˆÙ„ Ø·ÙˆØ±ÙŠ)
      // ØªÙ‚Ø±ÙŠØ¨: Ù…Ø¹Ø¯Ù„ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© Qdot = h*A*(Tf - Ta_eff) Ø­ÙŠØ« Ta_eff = Ta
      // Ø§Ù„Ø²Ù…Ù† = m*L / (h*A*Î”T_eff)
      let t2 = 0;
      const dT2 = Math.max( (props.Tf - Ta), 0.5 ); // Ù„Ø§ Ù†Ø¬Ø¹Ù„Ù‡Ø§ ØµÙØ±Ø§Ù‹ Ù„ØªØ¬Ù†Ø¨ Ù„Ø§Ù†Ù‡Ø§ÙŠØ©
      t2 = (m * props.Lh) / (h * A * dT2);

      // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: ØªØ¨Ø±ÙŠØ¯ Ù…Ù† Tf Ø¥Ù„Ù‰ Tt (Ø¥Ù† ÙƒØ§Ù† Tt<Tf)
      let t3 = 0;
      if(Tt < props.Tf){
        const num = m * props.cf;
        const arg = (props.Tf - Ta) / (Tt - Ta);
        if(arg>1){ t3 = (num/(h*A)) * Math.log(arg); }
      }

      // Ù…Ø¹Ø§Ù…Ù„ Ø£Ù…Ø§Ù†
      const safetyFactor = 1 + (parseFloat(safety.value)||0)/100;
      t1 *= safetyFactor; t2 *= safetyFactor; t3 *= safetyFactor;

      // Ø¥Ù„Ù‰ Ø¯Ù‚Ø§Ø¦Ù‚
      const t1m = t1/60, t2m = t2/60, t3m = t3/60;
      const total = t1m + t2m + t3m;

      // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
      t1Out.textContent = fmtMinutes(t1m);
      t2Out.textContent = fmtMinutes(t2m);
      t3Out.textContent = fmtMinutes(t3m);
      tTotal.textContent = fmtMinutes(total);

      // Ø´Ø±ÙŠØ· Ø²Ù…Ù†ÙŠ
      const s1 = total>0 ? (t1m/total)*100 : 0;
      const s2 = total>0 ? (t2m/total)*100 : 0;
      const s3 = total>0 ? (t3m/total)*100 : 0;
      seg1.style.width = s1+'%';
      seg2.style.left = s1+'%'; seg2.style.width = s2+'%';
      seg3.style.left = (s1+s2)+'%'; seg3.style.width = s3+'%';

      // ØªØ¹Ù„ÙŠÙ‚ Ø­Ø§Ù„Ø©
      let msg = 'â€”'; let cls = 'status';
      if(total>0){
        if(total<=60) { msg = 'â±ï¸ ØªØ¬Ù…ÙŠØ¯ Ø³Ø±ÙŠØ¹ Ù†Ø³Ø¨ÙŠØ§Ù‹.'; cls+=' good'; }
        else if(total<=240){ msg = 'ğŸ§Š Ø²Ù…Ù† Ù…ØªÙˆØ³Ø· â€” Ø­Ø³Ù† ØªØ¯ÙÙ‚ Ø§Ù„Ù‡ÙˆØ§Ø¡ ÙˆØ®ÙÙ‘Ù Ø§Ù„Ø³Ù…Ø§ÙƒØ© Ù„ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©.'; cls+=' warn'; }
        else { msg = 'ğŸ¢ ØªØ¬Ù…ÙŠØ¯ Ø¨Ø·ÙŠØ¡ â€” ÙÙƒÙ‘Ø± Ø¨ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ù…ÙŠÙ‘Ø² Ø£Ùˆ Ø®ÙÙ‘Ø¶ Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡.'; cls+=' bad'; }
      }
      status.className = cls; status.textContent = msg + ` | hâ‰ˆ${h.toFixed(1)} Ùˆ/Ù…Â²Â·Ùƒ | ÙƒØªÙ„Ø©â‰ˆ${m.toFixed(2)} ÙƒØº`;

      // Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±
      return {t1m,t2m,t3m,total,h,m,geom: {V,A,Dchar}};
    }

    // Ø£Ø­Ø¯Ø§Ø«
    foodSel.addEventListener('change', ()=>{ loadFoodProps(); calc(); syncURL(); });
    shapeSel.addEventListener('change', ()=>{ updateDimsUI(); calc(); syncURL(); });
    [Tair,Tinit,Ttarget,packSel,airflowSel,safety,rho,Tf,Lh,cu,cf,k,
     el('L'),el('W'),el('T'),el('D'),el('H'),el('Ds')].forEach(n=> n && n.addEventListener('input', ()=>{ calc(); syncURL(); }));

    // Ø£Ø²Ø±Ø§Ø±
    el('calc').addEventListener('click', ()=>{ calc(); });
    el('reset').addEventListener('click', ()=>{ location.href = location.pathname; });

    // ØªØµØ¯ÙŠØ± CSV
    el('exportCsv').addEventListener('click', ()=>{
      const r = calc(); if(!r) return;
      const rows = [
        ['Ø§Ù„Ø¨Ù†Ø¯','Ø§Ù„Ù‚ÙŠÙ…Ø©'],
        ['Ø²Ù…Ù† Ø§Ù„ØªØ¨Ø±ÙŠØ¯ Ø­ØªÙ‰ Ø§Ù„ØªØ¬Ù…Ø¯', fmtMinutes(r.t1m)],
        ['Ø²Ù…Ù† Ø§Ù„ØªØ¬Ù…ÙŠØ¯', fmtMinutes(r.t2m)],
        ['Ø²Ù…Ù† Ø§Ù„ØªØ¨Ø±ÙŠØ¯ ØªØ­Øª Ø§Ù„ØªØ¬Ù…Ø¯', fmtMinutes(r.t3m)],
        ['Ø§Ù„Ø²Ù…Ù† Ø§Ù„ÙƒÙ„ÙŠ', fmtMinutes(r.total)],
        ['h (Ùˆ/Ù…Â²Â·Ùƒ)', r.h.toFixed(2)],
        ['Ø§Ù„ÙƒØªÙ„Ø© (ÙƒØº)', r.m.toFixed(3)],
      ];
      const csv = rows.map(r=>r.join(',')).join('\n');
      const blob = new Blob(["\uFEFF"+csv], {type:'text/csv;charset=utf-8;'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'freezing-time-results.csv';
      a.click();
    });

    // Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø¨Ø± Ø§Ù„Ø±Ø§Ø¨Ø· (query string)
    function syncURL(){
      const params = new URLSearchParams();
      params.set('food', foodSel.value);
      params.set('Tair', Tair.value);
      params.set('Tinit', Tinit.value);
      params.set('Ttarget', Ttarget.value);
      params.set('shape', shapeSel.value);
      params.set('pack', packSel.value);
      params.set('air', airflowSel.value);
      params.set('safe', safety.value);
      ['L','W','T','D','H','Ds','rho','Tf','Lh','cu','cf','k'].forEach(id=>{
        const v = el(id); if(v) params.set(id, v.value);
      });
      history.replaceState(null,'','?'+params.toString());
    }

    function loadFromURL(){
      const q = new URLSearchParams(location.search);
      const set = (id,key=id)=>{const v=q.get(key); if(v!==null){const node=el(id); if(node){node.value=v;}}}
      set('food'); set('Tair'); set('Tinit'); set('Ttarget'); set('shape'); set('pack'); set('airflow','air'); set('safety','safe');
      set('L'); set('W'); set('T'); set('D'); set('H'); set('Ds');
      set('rho'); set('Tf'); set('Lh'); set('cu'); set('cf'); set('k');
      updateDimsUI(); if(q.get('food')) loadFoodProps();
    }

    el('share').addEventListener('click', ()=>{
      syncURL();
      navigator.clipboard.writeText(location.href).then(()=>{
        const label = document.getElementById('presetLabel');
        label.textContent = 'ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· âœ…';
        setTimeout(()=>label.textContent='Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¢Ù…Ù†Ø©',1500);
      });
    });

    // ØªÙ‡ÙŠØ¦Ø©
    loadFoodProps();
    updateDimsUI();
    loadFromURL();
    calc();
  </script>
</body>
</html>
